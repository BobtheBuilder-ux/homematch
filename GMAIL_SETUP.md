# Gmail SMTP Setup Guide

This guide will help you configure Gmail SMTP for email delivery in your real estate application.

## Prerequisites

1. **Gmail Account**: You need an active Gmail account
2. **2-Factor Authentication**: Required for App Passwords
3. **App Password**: A 16-character password generated by Google

## Step 1: Enable 2-Factor Authentication

### 1.1 Access Google Account Settings

1. **Go to Google Account**: Visit [myaccount.google.com](https://myaccount.google.com/)
2. **Navigate to Security**: Click on "Security" in the left sidebar
3. **Find 2-Step Verification**: Look for "2-Step Verification" section

### 1.2 Enable 2-Factor Authentication

1. **Click "2-Step Verification"**: Follow the setup process
2. **Add Phone Number**: Provide your phone number for verification
3. **Verify**: Complete the verification process with the code sent to your phone
4. **Enable**: Turn on 2-Step Verification

## Step 2: Generate App Password

### 2.1 Access App Passwords

1. **Go to Security Settings**: Return to [myaccount.google.com/security](https://myaccount.google.com/security)
2. **Find App Passwords**: Look for "App passwords" (only visible after enabling 2FA)
3. **Click App Passwords**: You may need to sign in again

### 2.2 Create App Password

1. **Select App**: Choose "Mail" from the dropdown
2. **Select Device**: Choose "Other (custom name)"
3. **Enter Name**: Type "HomeMatch Application" or similar
4. **Generate**: Click "Generate"
5. **Copy Password**: Copy the 16-character password (e.g., `abcd efgh ijkl mnop`)

**Important**: Save this password immediately - you won't see it again!

## Step 3: Update Environment Variables

Update your `/server/.env` file with the following variables:

```env
# Gmail SMTP Configuration
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@gmail.com        # Your Gmail address
EMAIL_PASS=your_16_char_app_password    # The App Password from Step 2
```

### Environment Variable Details:

- **EMAIL_HOST**: Gmail SMTP server (always `smtp.gmail.com`)
- **EMAIL_PORT**: SMTP port (always `587` for TLS)
- **EMAIL_USER**: Your Gmail email address
- **EMAIL_PASS**: The 16-character App Password (remove spaces)

### Example Configuration:

```env
# Gmail SMTP Configuration
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=support@homematch.ng
EMAIL_PASS=abcdefghijklmnop
```

## Step 4: Test Email Functionality

### 4.1 Restart Your Server

```bash
cd server
npm run dev
```

### 4.2 Run Email Test

```bash
cd server
npm run build
node dist/src/test-email.js
```

### 4.3 Expected Output

```
Testing Gmail SMTP email configuration...
Configuration:
- Email Host: smtp.gmail.com
- Email Port: 587
- Email User: your_email@gmail.com
- Has Email Password: true

ðŸ”§ Testing Gmail SMTP configuration...
âœ… Gmail SMTP configuration is valid!

ðŸ“§ Sending test email to: your_email@gmail.com
âœ… Test email sent successfully!
```

### 4.4 Verify Email Delivery

The application will automatically use Gmail SMTP for:
- Application confirmations
- Lease agreements
- Payment notifications
- Status updates
- User registration emails
- Password reset emails

## Step 5: Production Considerations

### 5.1 Security Best Practices

1. **Use App Passwords**: Never use your regular Gmail password
2. **Rotate Passwords**: Regularly generate new App Passwords
3. **Environment Variables**: Never commit credentials to version control
4. **Access Control**: Limit who has access to the App Password

### 5.2 Rate Limits

- **Daily Limit**: Gmail allows 500 emails per day for free accounts
- **Per Hour**: Maximum 100 emails per hour
- **Upgrade**: Consider Google Workspace for higher limits

### 5.3 Monitoring

```javascript
// Add this to your emailService.ts for debugging
console.log('Gmail Configuration:', {
  host: process.env.EMAIL_HOST,
  port: process.env.EMAIL_PORT,
  user: process.env.EMAIL_USER,
  hasPassword: !!process.env.EMAIL_PASS
});
```

## Step 6: Troubleshooting

### Common Issues:

1. **"Username and Password not accepted"**
   - Solution: Ensure 2FA is enabled and you're using an App Password
   - Check: Verify the App Password is correct (16 characters, no spaces)

2. **"Less secure app access"**
   - Solution: Use App Passwords instead of enabling less secure access
   - Note: Google deprecated "Less secure app access" in 2022

3. **"Connection timeout"**
   - Solution: Check your internet connection and firewall settings
   - Try: Use port 465 with SSL instead of 587 with TLS

4. **"Daily sending quota exceeded"**
   - Solution: Wait 24 hours or upgrade to Google Workspace
   - Monitor: Track your daily email volume

### Alternative Configuration (SSL):

If TLS doesn't work, try SSL:

```env
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=465
EMAIL_SECURE=true  # Add this for SSL
EMAIL_USER=your_email@gmail.com
EMAIL_PASS=your_app_password
```

### Debug Email Issues:

```javascript
// Add this to test connection
import { testEmailConfiguration } from './utils/emailService';

async function debugEmail() {
  const isValid = await testEmailConfiguration();
  console.log('Configuration valid:', isValid);
}
```

## Step 7: Google Workspace (Optional)

For production applications with high email volume:

1. **Upgrade to Google Workspace**: [workspace.google.com](https://workspace.google.com)
2. **Higher Limits**: Up to 2,000 emails per day
3. **Custom Domain**: Use your own domain for emails
4. **Better Support**: Access to Google Workspace support

### Workspace Configuration:

```env
# Google Workspace SMTP
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=noreply@yourdomain.com  # Your custom domain
EMAIL_PASS=your_workspace_app_password
```

## Cost Comparison

| Service | Free Tier | Paid Tier | Best For |
|---------|-----------|-----------|----------|
| Gmail | 500 emails/day | Google Workspace: $6/user/month | Small applications |
| AWS SES | 62,000 emails/month (from EC2) | $0.10 per 1,000 emails | High volume |
| SendGrid | 100 emails/day | $14.95/month for 40,000 | Medium applications |

## Support Resources

- **Gmail Help**: [support.google.com/mail](https://support.google.com/mail)
- **App Passwords**: [support.google.com/accounts/answer/185833](https://support.google.com/accounts/answer/185833)
- **Google Workspace**: [workspace.google.com/support](https://workspace.google.com/support)
- **Nodemailer Documentation**: [nodemailer.com](https://nodemailer.com)

---

**Note**: Replace placeholder values (like `your_email@gmail.com`, `your_app_password`) with your actual values. Keep your App Password secure and never share it publicly.